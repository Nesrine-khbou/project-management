@if (showModal && task) {
  <div
    class="fixed inset-0 z-50 grid place-items-center
           bg-black/50 backdrop-blur-sm p-4"
    (click)="closeModal()"
  >
    <div
      class="relative w-full max-w-lg rounded-2xl p-6
             bg-white/80 backdrop-blur border border-white/60 ring-1 ring-slate-200/60
             shadow-xl
             dark:bg-slate-900/70 dark:border-slate-700/40 dark:ring-slate-700/50"
      (click)="$event.stopPropagation()"
    >
      <!-- Close -->
      <button
        type="button"
        class="absolute right-3 top-3 grid h-9 w-9 place-items-center rounded-full
               text-slate-500 hover:text-slate-700 hover:bg-slate-900/5
               dark:text-slate-300 dark:hover:text-white dark:hover:bg-white/10 transition"
        (click)="closeModal()"
        aria-label="Close"
      >
        ✕
      </button>

      <!-- Header -->
      <h2
        class="text-2xl font-extrabold text-slate-900 dark:text-white
               pb-3 border-b border-slate-200/70 dark:border-slate-700/60"
      >
        {{ task.title }}
      </h2>

      <!-- Progress -->
      <div class="mt-5">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-semibold text-slate-700 dark:text-slate-200">Progression</span>
          <span class="text-sm font-bold text-slate-900 dark:text-white">{{ task.progress }}</span>
        </div>

        <div class="w-full rounded-full h-3 overflow-hidden
                    bg-slate-200/70 dark:bg-slate-700/50 ring-1 ring-slate-200/60 dark:ring-slate-700/60">
          <div
            class="h-3 rounded-full transition-all duration-300"
            [style.width]="task.progress"
            [ngClass]="getProgressColor(task.progress)"
          ></div>
        </div>
      </div>

      <!-- Details -->
      <div class="mt-6 grid grid-cols-2 gap-4">
        <div class="rounded-xl p-3 bg-white/50 ring-1 ring-slate-200/60 dark:bg-slate-900/40 dark:ring-slate-700/50">
          <p class="text-xs text-slate-500 dark:text-slate-300">Priorité</p>
          <p class="font-semibold text-slate-900 dark:text-white">{{ task.priority }}</p>
        </div>

        <div class="rounded-xl p-3 bg-white/50 ring-1 ring-slate-200/60 dark:bg-slate-900/40 dark:ring-slate-700/50">
          <p class="text-xs text-slate-500 dark:text-slate-300">Statut</p>
          <span
            class="inline-flex mt-1 px-3 py-1 text-xs font-semibold rounded-full border"
            [ngClass]="{
              'bg-rose-500/10 text-rose-700 border-rose-500/20 dark:bg-rose-400/10 dark:text-rose-200 dark:border-rose-400/20': task.status === 'En attente',
              'bg-amber-500/10 text-amber-700 border-amber-500/20 dark:bg-amber-400/10 dark:text-amber-200 dark:border-amber-400/20': task.status === 'En cours',
              'bg-emerald-500/10 text-emerald-700 border-emerald-500/20 dark:bg-emerald-400/10 dark:text-emerald-200 dark:border-emerald-400/20': task.status === 'Terminé'
            }"
          >
            {{ task.status }}
          </span>
        </div>

        <div class="rounded-xl p-3 bg-white/50 ring-1 ring-slate-200/60 dark:bg-slate-900/40 dark:ring-slate-700/50">
          <p class="text-xs text-slate-500 dark:text-slate-300">Assigné à</p>
          <p class="font-semibold text-slate-900 dark:text-white">{{ task.assignee }}</p>
        </div>

        <div class="rounded-xl p-3 bg-white/50 ring-1 ring-slate-200/60 dark:bg-slate-900/40 dark:ring-slate-700/50">
          <p class="text-xs text-slate-500 dark:text-slate-300">Date limite</p>
          <p class="font-semibold text-slate-900 dark:text-white">{{ task.deadline }}</p>
        </div>

        <div class="rounded-xl p-3 bg-white/50 ring-1 ring-slate-200/60 dark:bg-slate-900/40 dark:ring-slate-700/50 col-span-2">
          <p class="text-xs text-slate-500 dark:text-slate-300">Créé le</p>
          <p class="font-semibold text-slate-900 dark:text-white">{{ task.createdAt }}</p>
        </div>
      </div>

      <!-- Description -->
      <div class="mt-5">
        <p class="text-xs text-slate-500 dark:text-slate-300 mb-1">Description</p>
        <p class="text-sm leading-relaxed text-slate-900 dark:text-slate-100">
          {{ task.description }}
        </p>
      </div>
    </div>
  </div>
}
