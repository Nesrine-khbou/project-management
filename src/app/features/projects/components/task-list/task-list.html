<div class="mb-4 grid grid-cols-1 gap-3 md:grid-cols-12">
  <!-- Search -->
  <div class="md:col-span-8">
    <div
      class="flex items-center gap-2 rounded-2xl px-4 py-3
             bg-white/70 backdrop-blur border border-white/60 ring-1 ring-slate-200/60
             shadow-sm
             dark:bg-slate-900/50 dark:border-slate-700/40 dark:ring-slate-700/50"
    >
      <svg class="h-5 w-5 text-slate-400 dark:text-slate-300" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15z"/>
      </svg>

      <input
        type="text"
        placeholder="Rechercher une tâche..."
        [(ngModel)]="taskSearch"
        class="w-full bg-transparent outline-none
               text-slate-900 placeholder:text-slate-400
               dark:text-white dark:placeholder:text-slate-400"
      />
    </div>
  </div>

  <!-- Status filter -->
  <div class="md:col-span-2">
    <div
      class="rounded-2xl px-4 py-3
             bg-white/70 backdrop-blur border border-white/60 ring-1 ring-slate-200/60
             shadow-sm
             dark:bg-slate-900/50 dark:border-slate-700/40 dark:ring-slate-700/50"
    >
      <select
        [(ngModel)]="taskStatusFilter"
        class="w-full bg-transparent outline-none
               text-slate-900 dark:text-white"
      >
        <option value="">Tous les statuts</option>
        <option value="En attente">En attente</option>
        <option value="En cours">En cours</option>
        <option value="Terminé">Terminé</option>
      </select>
    </div>
  </div>

  <!-- Add task -->
  @if (showAddTaskButton) {
    <div class="md:col-span-2 md:flex md:justify-end">
      <button
        (click)="addTaskClick.emit()"
        type="button"
        class="w-full md:w-auto inline-flex items-center justify-center gap-2
               rounded-2xl px-2 text-sm font-semibold text-white
               bg-gradient-to-r from-indigo-600 to-indigo-500
               hover:opacity-95 hover:shadow-lg
               focus:outline-none focus:ring-2 focus:ring-indigo-500/40"
      >
        <span class="text-lg leading-none">+</span>
        Tâche
      </button>
    </div>
  }
</div>

<ul class="space-y-3 mt-4">
  @if (filteredTasks.length > 0) {
    @for (task of filteredTasks; track task.title) {
      <li
        class="group rounded-2xl p-4 flex items-center justify-between gap-4
               bg-white/70 backdrop-blur border border-white/60 ring-1 ring-slate-200/60
               shadow-sm hover:shadow-xl hover:-translate-y-0.5 transition
               dark:bg-slate-900/50 dark:border-slate-700/40 dark:ring-slate-700/50"
      >
        <div>
          <p class="text-slate-900 dark:text-white font-semibold text-sm md:text-base">
            {{ task.title }}
          </p>

          <p class="mt-1 text-xs text-slate-500 dark:text-slate-300 flex items-center gap-2">
            Priorité :
            <span
              [ngClass]="task.priority | priorityIndicator"
              class="w-3 h-3 rounded-full inline-block ring-2 ring-white/70 dark:ring-slate-900/60"
            ></span>
            <span class="font-semibold text-slate-700 dark:text-slate-200">{{ task.priority }}</span>
          </p>
        </div>

        <div class="flex items-center gap-2">
          <span
            class="px-3 py-1 text-xs font-semibold rounded-full border"
            [ngClass]="{
              'bg-rose-500/10 text-rose-700 border-rose-500/20 dark:bg-rose-400/10 dark:text-rose-200 dark:border-rose-400/20': task.status === 'En attente',
              'bg-amber-500/10 text-amber-700 border-amber-500/20 dark:bg-amber-400/10 dark:text-amber-200 dark:border-amber-400/20': task.status === 'En cours',
              'bg-emerald-500/10 text-emerald-700 border-emerald-500/20 dark:bg-emerald-400/10 dark:text-emerald-200 dark:border-emerald-400/20': task.status === 'Terminé'
            }"
          >
            {{ task.status }}
          </span>

          <button
            (click)="openDetails(task)"
            type="button"
            class="px-3 py-1 text-xs font-semibold rounded-full
                   bg-indigo-600/10 text-indigo-700 border border-indigo-500/20
                   hover:bg-indigo-600/15
                   dark:bg-indigo-400/10 dark:text-indigo-200 dark:border-indigo-400/20
                   transition"
          >
            Détails
          </button>
        </div>
      </li>
    }
  } @else {
    <li
      class="rounded-2xl p-6 text-center italic
             bg-white/60 backdrop-blur border border-white/60 ring-1 ring-slate-200/60
             dark:bg-slate-900/40 dark:border-slate-700/40 dark:ring-slate-700/50"
    >
      <span class="text-slate-500 dark:text-slate-300">Aucune tâche trouvée.</span>
    </li>
  }
</ul>

@if (showModal && selectedTask) {
  <app-task-details
    [task]="selectedTask"
    [showModal]="showModal"
    (close)="closeModal()"
  ></app-task-details>
}
